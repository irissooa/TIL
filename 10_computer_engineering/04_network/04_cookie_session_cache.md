# 04. Cookie & Session & Cache

<br>

## 1. HTTP의 속성

- HTTP 프로토콜은 `Connectionless`, `Stateless`한 특성이 있다. 그래서 HTTP 프로토콜 환경에서는 서버는 클라이언트가 누구인지 확인해야 한다.

- `Connectionless`(비연결지향)

  - <b>클라이언트가 요청한 후 응답을 받으면 그 연결을 끊어버리는 특징</b>
  - HTTP는 먼저 클라이언트가 request를 서버에 보내면, 서버는 클라이언트에게 요청에 맞는 response를 보내고 접속을 끊는 특성이 있다.
  - Header는 keep-alive라는 값을 줌으로써 connection을 재활용하는데 HTTP 1.1에서는 이것이 default이다.

  - HTTP가 TCP 위에서 구현되었기 때문에 네트워크 관점에서 keep-alive는 옵션으로 connectionless의 연결비용을 줄이는 것을 장점으로 비연결지향이라 한다.

- `Stateless`(무상태, 상태정보 유지 안 함)

  - <b>연결이 끊어지는 순간 클라이언트와 서버간의 통신이 끝남(각각 완벽하게 독립적)</b>
  - 통신이 끝나면 상태를 유지하지 않는 특징

- 이와 같은 HTTP의 `Connectionless`와 `Stateless` 특징으로 인해 매번 새로운 인증을 해야하는 번거로움이 발생하는데 이를 해결하기 위해 상태를 기억하는 방법 중 `Cookie`와 `Session`이 있다.

  - 이들을 사용하지 않으면 어떤 쇼핑몰에서 물품을 구매하기 위해 로그인을 해도 페이지를 이동하면 로그인한 정보를 기억하지 못해서 다시 또 로그인해야하는 번거로움이 발생한다.

<br>

## 2. Cookie

### (1) 특징

- <b>클라이언트(브라우저)의 로컬에 저장</b>되는 키 값의 작은 데이터 파일
- 웹페이지에 접속하면 요청한 웹페이지를 서버로부터 받고 쿠키를 로컬에 저장하고, 클라이언트가 재요청시 웹피이지 요청과 함께 쿠키 값도 함께 전송
- 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지된다는 특징이 있다.
- 클라이언트에 300개까지 쿠키를 저장할 수 있고 하나의 도메인당 20개의 값만 가질 수 있다.
- 하나의 쿠키 값은 4[KB]까지 저장할 수 있다.
- 쿠키는 사용자가 따로 요청하지 않아도 브라우저가 Request시에 Request Header를 넣어서 자동으로 서버에 전송합니다.

<br>

### (2) 동작 방식

- 클라이언트가 페이지 요청
- 서버에서 쿠키 생성
- HTTP 헤더에 쿠키를 포함 시켜 응답
- 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
- 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
- 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

<br>

### (3) 치명적인 단점

- 쿠키는 서버가 클라이언트의 요청을 식별하는데 사용된다.
- 쿠키를 활용해서 사용자를 구분하는게 매우 유용하지만, 클라이언트가 수정할 수도 있고 해커카 탈취할 수도 있기 때문에 <b><u>보안에 매우 취약하다</u></b>.
- 그래서 쿠키는 아이디, 비밀번호와 같은 민감한 정보들을 저장하는데 사용하지 않고 가벼운 정보들을 저장할 때 사용한다.
  - ex) 아이디 자동완성 / 공지 메세지 하루 안보기 / 팝업 안보기 체크 / 비로그인 장바구니에 담기 등 편의를 위하되 <u>지워지거나 유출되도 큰 일은 없을 정보들(가벼운 정보들)을 저장</u>

<br>

## 3. Session

### (1) 특징

- 쿠키를 기반으로 하지만 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 <b>서버 측에서 관리</b>한다.
- 사이트와 특정 브라우저(클라이언트) 사이의 상태를 유지하는 것
- 일정 시간동안 같은 브라우저로부터 들어오는 일련의 요구를 하나의 상태로 보고 상태를 유지하는 기술
- 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지한다.
- 물론 접속 시간에 제한을 두어 일정 시간 응답이 없다면 정보가 유지되지 않게 설정이 가능하다.
- 사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 보안에 좋다.
  - 사용자나 다른 누군가에게 노출되어서는 안 되는, 서비스 제공자가 직접 관리해야 할 정보들을 세선으로 서버 안에서 관리된다.
- 하지만 세션을 너무 남발해도 안 되는 이유는 사용자가 많아질수록 서버 메모리를 많이 차지하게 된다.
  - 즉 동접자 수가 많은 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 된다.
- 클라이언트가 request를 보내면 해당 서버의 엔진이 클라이언트에게 유일한 ID를 부여하는 데 이것이 세션 ID이다.
- 클라이언트가 서버에 접속하면 서버가 <u>특정 session id를 발급하고 클라이언트는 session id를 쿠키를 사용해 저장.</u> 클라이언트가 서버에 다시 접속하면 해당 쿠키(session id가 담긴)를 이용해 <u>서버에 session id를 전달하여 인증을 받게 된다.</u>
  - 서버 측에서 클라이언트에게 session id(임시 키) 발급, 그 아이디를 클라이언트 측에서 들고 있고 쿠키에 담아 서버로 보내 어떤 사용자인지 서버가 인식함(session id : 중요정보에 접근하기 위한 키)
  - session id가 없으면 서버는 새로운 사용자라고 인식하게 됨
- 쿠키를 지우면 로그아웃은 왜??
  - 서버에서는 session에 사용자 로그인 정보를 가지고 있지만, 그것이 내꺼라는 걸 증명할 session id가 쿠키에서 사라졌기 때문이다.
- 세션은 사용자 수만큼 서버 메모리를 차지하므로 최근에는 이런 문제를 보완한 토큰 기반의 인증방식을 사용하는 추세인데 그 중 하나가 `JWT(JSON Web Token)`이다.

<br>

### (2) 동작 방식

- 클라이언트가 서버에 접속 시 세션 ID 발급
- 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장하고 가지고 있음
- 클라이언트는 서버에 요청할 때 이 쿠키의 세션 ID를 서버에 전달해서 사용
- 서버는 세션 ID를 전달 받아 별다른 작업없이 세션 ID로 세션에 있는 클라이언트 정보를 가져옴
- 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답

<br>

## :exclamation: Cookie VS Session 차이점

- Cookie
  - 클라이언트(브라우저) 쪽에 저장(내가 가지고 있음) => 브라우저에 저장하므로 함부로 정보를 바꿀 수 있으므로 민감한 데이터를 탈취당할 수 있기 때문에 보안에 취약
  - 브라우저가 꺼져도 삭제되지 않고 사용자가 삭제하거나 정해진 시간만큼 유지
  - 문자열만 저장할 수 있음
  - 클라이언트에서 보내므로 속도가 빠름
- Session
  - 서버쪽에 저장 => 서버에서 민감한 데이터를 가지고 있으므로 비교적 보안이 좋음
  - 브라우저가 꺼질 경우 삭제됨
  - 문자열 뿐만 아니라 객체도 저장가능
  - 서버쪽에서 처리하므로 속도가 비교적 느림

<br>

## 4. Cache

- 캐시라는 개념은 웹 뿐만 아니라 컴퓨터의 메모리 부분이나 안드로이드 등 다양한 곳에서 쓰인다.
- <b>가져오는데 비용이 드는 데이터를 한 번 가져온 뒤에는 임시로 저장해두는 곳</b>
- 웹 캐시는 css, js, 이미지 등의 정보를 불러올 때 데이터 사용량도 발생하고 시간도 들기 때문에 사용자가 여러 번 방문할 법한 사이트에서는 한 번 받아온 데이터를 <b>사용자의 컴퓨터 또는 중간 역할을 하는 서버에 저장</b>하는 것이다.

<br>

---

:book: <b>Reference</b>

- https://interconnection.tistory.com/74

- https://jeong-pro.tistory.com/80

- https://github.com/baeharam/Must-Know-About-Frontend/blob/master/Notes/network/cookie-session.md
- https://www.youtube.com/watch?v=OpoVuwxGRDI