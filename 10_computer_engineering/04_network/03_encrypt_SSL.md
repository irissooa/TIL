# 03. Encrypt(암호화) + SSL

<br>

## 1. 개인키 암호화 기법(= 비밀키 암호화 방식)

### (1) 특징

- 전송 측과 데이터를 암호화할 때, 수신 측에서 데이터를 복호화할 때 서로 <b>동일한 방식의 키</b>를 사용한다.
- 그래서 <b>대칭 암호 방식</b> 또는 <b>단일키 암호화 기법</b>이라고도 한다.
- 비밀키는 제3자에게는 노출시키지 않고, 데이터베이스 사용 권한이 있는 사용자만 나누어 가진다.
- 이 방식의 문제는 양쪽 당사자가 서로 물리적인 만남 없이 시크릿을 협상하는 방법이라서 일종의 보안 통신 채널이 필요하다.
- 대표적으로 DES(Data Encryption Standard)가 있다.
- 장점
  - 암호화/복호화 속도가 빠르다.
  - 알고리즘이 단순하다.
  - 파일의 크기가 작다.
- 단점
  - 사용자의 증가에 따라 관리해야 할 키의 수가 상대적으로 많아진다.
  - 암호를 주고 받는 사람들 사이에 대칭키를 전달하는 것이 어렵고 대칭키가 유출되면 키를 획득한 공격자는 암호의 내용을 복호화할 수 있기 때문에 암호가 무용지물이 된다.

<br>

### (2) 동작 원리

- 통신을 수행하는 두 주체 간에 암호화에 사용되는 공통된 키를 가지고 진행한다.

<br>

## 2. 공개키 암호화 기법

### (1) 특징

- 전송 측과 수신 측은 <b>서로 다른 키</b>로 데이터를 암호화하고 복호화한다.
- 즉, A키를 암호화하면 B키로 복호화할 수 있고, B키로 암호화하면 A키로 복호화할 수 있는 방식이다.
- 데이터를 암호화할 때 사용하는 키(공개키, Public Key)는 데이터베이스 사용자에게 공개하고, 복호화할 때의 키(비밀키, Secret Key)는 관리자가 비밀리에 관리하는 방법이다.
- 공개 키와 개인 키의 개념을 기반으로 하는 이 방식은 대칭 암호 방식의 문제를 해결했다.
- <b>비대칭 암호 방식</b>이라고도 하며, 대표적으로 RSA(Rivest Shamir Adleman)가 있다.
- 장점
  - 키의 분배가 용이하다.
  - 관리해야 할 키의 개수가 적다.
- 단점
  - 암호화/복호화 속도가 느리다.
  - 알고리즘이 복잡하다.
  - 파일의 크기가 크다.

<br>

### (2) 동작 원리

- 원리 설명
  - 공개키를 제공 받은 타인은 공개키를 이용해서 정보를 암호화한다.
  - 암호화한 정보를 비공개키를 가지고 있는 사람에게 전송한다.
  - 비공개키의 소유자는 이 키를 이용해서 암호화된 정보를 복호화한다.
  - 이 과정에서 공개키가 유출된다고 해도 비공개키를 모르면 정보를 복호화할 수 없기 때문에 안전하다.
  - 공개키로는 암호화라 수 있지만 복호화는 할 수 없기 때문이다.

- 예시 (앨리스와 밥) <a href="https://webactually.com/2018/11/http%EC%97%90%EC%84%9C-https%EB%A1%9C-%EC%A0%84%ED%99%98%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%99%84%EB%B2%BD-%EA%B0%80%EC%9D%B4%EB%93%9C/" target="_blank">(출처)</a>

  <img src="https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/589faa3c-1af5-45d9-a5c7-1dc3595c4388/asymmetric-encryption-opt.png">

  - 앨리스와 밥은 공개키(`public`)와 개인키(`private`)의 쌍을 가졌다.
  - 개인키는 각 소유자만 알고 있고 공개키는 누구든 사용할 수 있다.
  - 앨리스가 밥에게 메시지를 보내고 싶다면 앨리스는 밥의 공개키를 얻어 평문을 암호화하고 암호문을 밥에게 보낸다.
  - 밥은 자신의 개인키를 사용해 암호문을 복호화한다.
  - 밥이 앨리스에게 답장하고 싶다면 앨리스의 공개키를 얻어 평문을 암호화하고 암호문을 앨리스에게 보낸다.
  - 앨리스는 자신의 개인키를 사용해 암호문을 복호화한다.

---

:grey_question: <b>공개키 암호화 방식을 비공개키를 이용해서 암호화하는 방식으로도 사용할 수 있는 이유</b>

- 공개키 암호화 방식은 다음과 같은 방식으로도 응용이 가능하다.
  - 비공개키의 소유자는 비공개키를 이용해서 정보를 암호화 한 후 공개키와 함께 암호화된 정보를 전송한다.
  - 정보와 공개키를 획득한 사람은 공개키를 이용해서 암호화된 정보를 복호화한다.
  - 이 과정에서 공개키가 유출된다면 의도하지 않은 공격자에 의해 데이터가 복호화될 위험이 존재한다.
- 그럼에도 불구하고 비공개키를 이용해서 암호화하는 방식을 사용하는 이유는 단순히 데이터를 보호하는 것이 목적이 아니기 때문이다.
  - 암호화된 데이터를 공개키를 가지고 복호화 할 수 있다는 것은 그 데이터가 공개키와 쌍을 이루는 비공개키에 의해서 암호화 되었다는 것을 의미한다.
  - 즉 공개키가 데이터를 제공한 사람의 <b>신원을 보장</b>해주게 되는 것이다.
  - 이러한 것은 `전자 서명` 이라고 부른다.

---

<br>

## 3. SSL(Secure Socket Layer)

> 원래는 `02. HTTP & HTTPS`에서 다루어야하는 내용이지만 개인기 암호화와 공개키 암호화 개념을 먼저 익힌 후 SSL 개념을 접해야 이해하기 쉽기 때문에 SSL 내용을 `03. Encrypt + SSL`에 작성했다.

<br>

### (1) SSL 이란?

- SSL 프로토콜은 Netscape 사에서 웹 서버와 브라우저 사이의 보안을 위해 만들어졌다. CA(인증 기관)라 불리는 Third-Party로부터 서버와 클라이언트의 인증을 하는데 사용된다.

- SSL Architecture 구조

  <img src="https://t1.daumcdn.net/cfile/tistory/231B4738590C36BE1E">

  - HTTP 프로토콜 상위에 통신시 보안을 위한 SSL 관련 프로토콜이 있는 방식이다.

- SSL은 암호화된 데이터를 전송하기 위해 공개키와 대칭키를 혼합해서 사용한다.

  - 즉 클라이언트와 서버가 주고 받는 실제 정보는 대칭키 방식으로 암호화하고, 대칭키 방식으로 암호화된 실제 정보는 복호화할 때 사용할 대칭키는 공개키 방식으로 암호화해서 클라이언트와 서버가 데이터를 주고 받게 된다.(실제 데이터: 대칭키, 대칭키의 키: 공개키)

- 참고로 SSL와 TLS(Transport Layer Security Protocol)은 같은 의미이다.

  - Netscape에 의해 SSL이 발명되었고 이것이 점차 폭넓게 사용되다가 표준화 기구인 IETF의 관리로 변경되면서 TLS라는 이름으로 바뀌었다.
  - TLS 1.0은 SSL 3.0을 계승한다.
  - 하지만 TLS라는 이름보다 SSL 이라는 이름이 훨씬 많이 사용되고 있다.

<br>

### (2) SSL 인증서

- SSL 인증서는 클라이언트와 서버간의 통신을 제3자가 보증해주는 전자화된 문서이다.
- 클라이언트가 서버에 접속한 직후에 서버는 클라이언트에게 이 인증서 정보를 전달하게 된다.
- SSL과 SSL 인증서 사용시 이점
  - 통신 내용이 공격자에게 노출되는 것을 막을 수 있다.
  - 클라이언트가 접속하려는 서버가 신뢰할 수 있는 서버인지를 판단할 수 있다.
  - 통신 내용의 악의적인 변경을 방지할 수 있다.
- SSL 인증서 역할
  - 클라이언트가 접속한 서버가 신뢰할 수 있는 서버임을 보장한다.
  - SSL 통신에 사용할 공개키를 클라이언트에게 제공한다.
- SSL 인증서에 포함된 내용
  - 서비스의 정보(인증서를 발급한 CA, 서비스의 도메인 등등)
  - 서버측 공개키(공개키 내용, 공개키 암호화 방법)

<BR>

### (3) SSL 인증서 발급 과정

- 애플리케이션 서버를 운영하는 기업은 HTTPS 적용을 위해 공개키와 개인키를 만든다.

- 신뢰할 수 있는 CA 기업을 선택하고 인증서 생성을 요청한다.

- CA는 서버의 공개키, 암호화 방법 등의 정보를 담은 인증서를 만들고 해당 CA의 개인키로 암호화하여 서버에 제공한다.

- 클라이언트가 SSL로 암호화된 페이지(https://)를 요청시 서버는 인증서를 전송한다.
- CA는 웹 브라우저에게 자신의 공개키를 제공하고 브라우저의 CA 리스트에 내장된다.
  - 브라우저의 소스코드 안에 CA의 리스트가 들어있는데 브라우저가 미리 파악하고 있는 CA의 리스트에 포함되어야만 공인된 CA가 될 수 있다.
  - 그래서 브라우저는 CA의 리스트와 함께 각 CA의 공개키를 이미 알고 있다.

<br>

### (4) SSL을 이용한 클라이언트와 서버 간의 통신 과정

<a href="https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Network/HTTP%2C%20HTTPS.md" target="_blank"><img src="https://user-images.githubusercontent.com/33534771/75338777-a1d9bf80-58d2-11ea-9754-809110475c89.png"></a>

- 클라이언트가 서버에 접속하여 SSL로 암호화된 페이지를 요청한다.
- 서버는 클라이언트에게 인증서를 전송한다.
- 클라이언트는 서버의 인증서가 CA에 의해 발급된 것인지 확인하기 위해 검증과정을 거친다.
  - 브라우저는 CA 리스트와 해당 CA의 공개키를 가지고 있다.
  - 공개키를 활용하여 인증서가 복호화가 가능하다면 접속한 사이트가 CA에 의해 검토되었다는 것을 의미한다. 즉, 인증서는 CA의 개인키로 암호화된 문서임이 암시적으로 보증된 것이다.
  - 공개키가 데이터를 제공한 사람의 신원을 보장해주는 것으로 이러한 절차로 인증서를 전송한 서버를 신뢰하는 이러한 과정을 `전자 서명` 이라고 한다.
- 클라이언트는 CA의 공개키를 이용해서 인증서를 복호화하고 서버의 공개키를 획득한다.
- 클라이언트는 서버의 공개키를 이용해서 랜덤 대칭 암호화키, 데이터 등을 암호화하여 서버로 전송한다.
- 서버는 자신의 개인키를 이용해서 복호화하고 랜덤 대칭 암호화키, 데이터 등을 획득한다.
- 서버는 랜딤 대칭 암호화키로 클라이언트 요청에 대한 응답을 암호화하여 전송한다.
- 클라이언트는 랜덤 대칭 암호화키를 이용해 복호화하고 데이터를 이용한다.
- 데이터 전송이 끝나면 SSL 통신이 끝났음을 서로에게 알려준다. 이 때 통신에서 사용한 대칭키인 세션키를 폐기하게 된다.

---

:heavy_plus_sign: <b>모든 웹페이지에서 HTTPS를 사용하는 것은 아니다.</b>

- 모든 웹페이지에서 HTTPS를 사용하지 않는다.
  - 이유는 평문 통신에 비해서 암호화 통신은 CPU나 메모리 등 리소스를 많이 필요로 하기 때문이다.
  - 통신할 때마다 암호화를 하면 리소스를 소비하기 때문에 서버 한 대당 처리할 수 있는 Request 수가 줄어들게 된다.

- 따라서 민감한 정보를 다룰 때만 HTTPS에 의한 암호화 통신을 사용해야 한다.

---

:grey_question: <b>SSL을 이용해서 통신할 때 대칭키와 공개키를 조합해서 사용하는 이유</b>

- 공개키 방식이 많은 컴퓨터 파워를 사용하기 때문이다.
- 만약 공개키만을 사용한다면 많은 접속이 몰릴 때 서버는 매우 큰 비용을 지불해야 한다.
- 반대로 대칭키는 암호를 푸는 열쇠인 대칭키를 상대에게 전송해야 하는데, 암호화가 되지 않은 인터넷을 통해서 키를 전송하는 것은 매우 위험하다.
- 그래서 속도는 느리지만 데이터를 안전하고 주고 받을 수 있는 공개키 방식으로 대칭키를 암호화하고, 실제 데이터를 주고 받을 때는 데칭키를 이용해서 데이터를 주고 받는 것이다.

---

<br>

---

:book: <b>Reference</b>

- 정보처리기사 총정리(2019), 시나공출판사
- [https://webactually.com/2018/11/http%EC%97%90%EC%84%9C-https%EB%A1%9C-%EC%A0%84%ED%99%98%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EC%99%84%EB%B2%BD-%EA%B0%80%EC%9D%B4%EB%93%9C/](https://webactually.com/2018/11/http에서-https로-전환하기-위한-완벽-가이드/)
- https://12bme.tistory.com/80
- https://real-dongsoo7.tistory.com/110
- [https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Network/HTTP%2C%20HTTPS.md](https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Network/HTTP%2C HTTPS.md)