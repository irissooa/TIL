# 01. Process & Thread

<br>

## 1. Process

### (1) 의미

- 프로그램
  - 어떤 작업을 위해 실행할 수 있는 파일
  - 실행가능한 명령어의 집합
- 프로세스
  - 컴퓨터에서 연속적으로 실행되고 있는 컴퓨터 프로그램
  - <b>메모리에 적재되어 실행되고 있는 프로그램</b>
  - 운영체제로부터 시스템 자원을 할당받는 작업의 단위
  - 메모리에 올라와 실행되고 있는 프로그램의 인스턴스(독립적인 개체)
  - 동적인 개념으로는 실행중인 프로그램
- 운영체제로부터 할당받는 시스템 자원
  - CPU 시간
  - 운영되기 위해 필요한 주소 공간
  - Code, Data, Stack, Heap 구조로 되어있는 독립된 메모리 영역
- Code, Data, Stack, Heap
  - Code : 프로그램의 실제 코드
  - Data : 프로세스가 실행될 때 정듼 전역 번수(static 변수들을 저장)
  - Heap : 프로세스 런타임 중 동적으로 할당되는 변수들을 저장(함수 내에서 할당되는 변수 등)
  - Stack : 함수에서 다른 함수를 실행하는 등의 서브루틴들의 정보를 저장(재귀와 스택이 관련있는 이유)
- 특징
  - 프로세스는 각각 독립된 메모리 영역(Code, Data, Stack, Heap)을 할당받는다.
  - 기본적으로 프로세스 당 최소 1개의 스레드(메인 스레드)를 갖는다.
  - 각 프로세스는 별도의 주소 공간에서 실행되며, 한 프로세스는 다른 프로세서의 변수나 자료구조에 접근할 수 없다.

<br>

### (2) IPC 통신

- 운영체제는 각각의 프로세스는 독립적으로 관리하기 때문에 서로 다른 프로세스가 겹칠 일이 없고, 또 사용 자원 영역 등이 겹치는 일이 발생해서도 안 된다.
  - 한 프로세스가 다른 프로세스의 정보 한 부분을 변경하면 그 프로세스에 치명적인 오류가 날지도 모르는 일이기 때문이다.
  - 프로그램의 프로세스들은 Code 영역은 공유한다는 것은 예외
    - 용이 동일한 프로그램의 코드를 여러 개 복사해서 프로세스마다 가지고 있는 것 보다는 메모리 상의 코드 공간을 주소로 참조하는 것이 상식적으로 낫다.

- 대부분의 운영체제는 독립적인 각 프로세스가 다른 프로세스의 정보를 변경하는 것을 극도로 주의하고 있으며 필요할 경우 최소한의 인터페이스를 제공해 소통할 수 있도록 하고 있다.
- 이와 같이 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스 간의 통신인 IPC(inter-process communication)를 사용해야 한다.
  - ex) 파이프, 파일, 소켓 등을 이용한 통신 방법
- 참고로 프로세스간 통신은 꼭 같은 컴퓨터에서의 프로세스를 가정할 이유는 없다. 다른 컴퓨터에 위치한 두 프로세스가 통신할 수도 있는데 이때 운영 시스템 등이 다를 수 있기 때문에 통신을 위해 그 유명한 ‘Protocol’이 필요해진다.
- 단점
  - 프로세스는 각각의 독립된 메모리 영역을 할당받는다. 그렇기 때문에 하나의 프로그램에 속하는 프로세스들 사이의 변수나 자료구조를 공유할 수 없다. IPC라는 방법을 사용해 프로세스간 통신을 할 수 있다.

<br>

### (3) 프로세스 제어 블록(PCB)

- 운영체제가 시스템 내의 프로세스들을 관리하기 위해 각 프로세스의 정보를 담은 커널 내의 자료구조
- 운영체제가 프로세스에 대한 중요한 정보를 저장해 놓는 곳으로 각 프로세스가 생성될 대마다 고유의 PCB가 생성되고, 프로세스가 완료되면 PCB가 제거됨
- PCB에 저장되어 있는 정보
  - 프로세스의 현재 상태 : new, ready, running, waiting, terminated 등의 상태를 저장
  - 프로세스 고유 식별자(PID) : 프로세스 식별 번호
  - 스케줄링 및 프로세스의 우선순위

<br>

## 2. Multitasking, Context Switch

### (1) Multitasking

- 한 컴퓨터에서 여러 가지 작업을 동시에 하는 것을 multitasking이라고 하며 현대 운영체제는 모두 multitasking을 지원한다.
- 컴퓨터가 수많은 작업을 동시에 하고 있는 것처럼 생각이 되지만 사실 `Time Sharing` 기법을 통해 '동시'라고 느껴질만큼 매우 짧은 시간 동알 작업하고(CPU를 점유하고) 다른 프로세스에 CPU 자원을 양보하는 과정이 수행된다.
  - 이와 같은 전환 속도가 매우 짧아 우리는 여러 프로세스들이 동시에 실행되고 있다고 생각하는 것이다.

<br>

### (2) Context Switch

- multitasking 과정에서 작업 중인 프로세스에 대한 정보를 Context라고 하는데 <b>새로운 프로세스에게 CPU를 할당하기 위해 현재 CPU가 할당된 프로세스의 상태 정보를 저장하고, 새로운 프로세스의 상태 정보를 설정한 후 CPU를 할당하여 실행되는 작업 즉, 프로세스가 전환되면서 Context를 전환하는 것을 Context Switch(문맥 교환)라고 한다.</b>
- 프로세스 상에서 Context Switch가 일어나면 이때 작업 중이던 Context를 저장하고 새로운 Context를 불러오면서 CPU 레지스터 상태 변환, 메모리 초기화 등 무거운 작업이 진행되고 많은 시간이 소모되는 오버헤드가 발생한다.(멀티 프로세스의 단점)
- Context Switch의 비용은 프로세스가 스레드보다 더 많이 든다.
  - 이유 : 스레드는 Stack 영역을 제외한 모든 메모리를 공유하므로 Context Switch 발생시 Stack 영역만 변경을 진행하면 되기 때문이다.

<br>

## 3. Thread

### (1) 의미

- 하나의 프로세스 내에서 병행성을 증대시키기 위한 메커니즘으로 시스템의 여러 자원을 할당받아 실행하는 프로그램의 단위
- 프로세스 내에서 실행되는 <b>흐름</b>
- 프로세스의 특정한 수행 경로
- 프로세서가 할당받은 자원을 이용하는 실행의 단위
- 독립적인 스케줄링의 최소 단위로서, 동일 프로세스 환경에서 서로 독립적인 다중 수행이 가능하다.
- 스택을 스레드마다 독립적으로 할당한 이유
  - 스택은 함수 호출시 전달되는 인자, 복귀 주소값 및 함수 내에서 선언하는 변수 등을 저장하기 위해 사용되는 메모리 공간이다.
  - 스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능함을 의미하고 이는 독립적인 실행 흐름이 추가된다는 것이다.
  - 따라서 스레드의 정의에 따라 독립적인 실행 흐름을 추가하기 위한 최소 조건으로 독립된 스택을 할당하는 것이다.

<br>

### (2) 장점

- 하나의 프로세스를 여러 개의 스레드로 생성하여 병행성 증진
- 하드웨어, 운영체제의 성능과 응용 프로그램의 처리율 향상
- 응용 프로그램의 응답 시간 단축
- 실행 환경을 공유시켜 기억장소 및 자원의 낭비가 줄어듬
- 공통적으로 접근 가능한 기억장치를 통해 효율적으로 통신

<br>

### (3) Multi Thread

- 기본적으로 하나의 프로세스는 하나의 스레드로 시작되며 이를 메인 스레드라고 하고 스레드를 추가로 생성하지 않는 한 모든 프로그램은 메인 스레드에서 실행된다.
- 일반적인 코드를 구성하는 과정을 생각해보면 json 파일을 불러와서 읽고 내용을 변경한 후 다시 수정된 json 파일을 저장하는 세 가지의 부분과정이 순차적으로 진행되어 각 작업 간 의존관계가 있는 코드들이 대부분일 것이다.
- 이러한 순차적인 방식은 중간과정의 한 부분이 오래걸리면 전체 프로그램 실행 속도가 느려지는 단점이 있다.
- 하지만 모든 작업이 순차적으로만 진행되어야 한다는 법은 없다. 한 프로세스 내에서 서로 순서상 의존하지 않고 다른 작업의 종료를 기다리지 않아도 되는 경우도 존재한다.
- 이 때 실행되는 흐름, 스레드를 여러 개 두면 병목현상에 걸리지 않고 전체 작업시간을 줄일 수 있는데 이를 멀티 스레드라고 한다.
- 장점
  - 시스템의 자원 소모가 줄어든다.
    - 기존 프로세스의 자원을 다른 스레드와 공유하기 때문에 자원을 새로 할당하지 않아도 된다.
  - 전체 응답 시간이 단축된다.
    - 시간도 자원이므로 오버헤드가 줄어들어 전체 응답이 짧아진다.
    - 또한 병목이 걸리는 작업과 다른 작업을 구분할 수 있기 때문에 전체 실행시간을 줄일 수 있다.
- 단점
  - 주의 깊은 설계가 필요하며 디버깅이 어렵다.
    - 여러 스레드를 이용하는 프로그램을 작성하면 설계를 신경써야 한다. 미묘한 시간 차이나 잘못된 변수 공유로 인해 문제가 발생할 수 있다.(더 큰 자유에는 더 큰 책임이 따른다는 것과 일맥상통)
  - 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.
- 주의사항
  - 한정적인 시스템 자원에 여러 스레드가 동시에 접근해서 사용하면 문제가 발생할 수 있기 때문에 이를 방지하기 위해서 여러 스레드에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정하는 '동기화' 문제를 고려해야 한다.

<br>

## :exclamation: Process VS Thread 비교 정리

| 항목      | Process                                                      | Thread                                                       |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 실행 방식 | 운영체제로부터 독립된 시간, 공간 자원을 할당 받아 실행       | 한 프로세스 내에서 많은 자원을 공유하며 병렬적으로 실행      |
| 자원 공유 | 일반적으로 공유 안 함. 같은 프로그램의 프로세스인 경우 코드는 공유함 | 같은 프로세스 내 스레드들은 스택을 제외한 나머지 세 영역을 공유 |
| 통신      | 오직 시스템이 제공하는 IPC 방법으로만 통신, 시스템에 의해 관리되므로 상대적으로는 안전하나 스레드간 통신보다 어렵다. | 단순히 공유 변수 수정만으로 스레드간 통신을 구현할 수 있어 통시니 매우 용이하지만 안전한 프로그램을 만들기 위해서는 신중해야 함 |
| 문맥 교환 | Switch 될 때 오버헤드 발생                                   | 더 빠르고 자원소모가 적다.                                   |

---

:book: <b>Reference</b>

- [https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Operating%20System/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80%20%EC%8A%A4%EB%A0%88%EB%93%9C.md](https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Operating System/프로세스와 스레드.md)
- https://github.com/wally-wally/tech-interview/blob/master/contents/os.md
- https://shoark7.github.io/programming/knowledge/difference-between-process-and-thread
- 

